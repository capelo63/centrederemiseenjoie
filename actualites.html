<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualités - Le Centre de Remise en Joie</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .actualites-header {
            background: linear-gradient(rgba(31, 87, 51, 0.8), rgba(31, 87, 51, 0.8)), 
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23e8f5e8"/><path d="M0 0h100v100H0z" fill="none" stroke="%23c8e6c9" stroke-width="0.5"/></svg>');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 10rem 2rem 4rem 2rem;
            text-align: center;
        }
        
        .actualites-header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 1rem;
        }
        
        .actualites-header p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .actualites-main {
            max-width: 1200px;
            margin: 3rem auto;
            padding: 0 2rem;
        }
        
        .actualites-list {
            display: grid;
            gap: 3rem;
        }
        
        .actualite-full {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .actualite-full:hover {
            transform: translateY(-2px);
        }
        
        .actualite-full img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .actualite-full-content {
            padding: 2rem;
        }
        
        .actualite-full-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .actualite-full-titre {
            font-size: 1.8rem;
            color: #1F5733;
            margin-bottom: 1.5rem;
            font-weight: 300;
        }
        
        .actualite-full-contenu {
            color: #555;
            line-height: 1.8;
            font-size: 1.1rem;
        }
        
        .retour-accueil {
            display: inline-block;
            margin: 2rem 0;
            padding: 1rem 2rem;
            background-color: #1F5733;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .retour-accueil:hover {
            background-color: #153B23;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 3rem 0;
        }
        
        .pagination button {
            padding: 0.8rem 1.5rem;
            border: 2px solid #1F5733;
            background-color: white;
            color: #1F5733;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .pagination button:hover,
        .pagination button.active {
            background-color: #1F5733;
            color: white;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .facebook-integration {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin: 3rem 0;
            text-align: center;
        }
        
        .facebook-integration h3 {
            color: #1F5733;
            margin-bottom: 1rem;
        }
        
        .facebook-integration p {
            color: #666;
            margin-bottom: 2rem;
        }
        
        .facebook-link {
            display: inline-block;
            padding: 1rem 2rem;
            background-color: #1877f2;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .facebook-link:hover {
            background-color: #166fe5;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="images/logo.png" alt="Logo Centre de Remise en Joie" class="logo-image">
                <h1>Le Centre de Remise en Joie</h1>
            </div>
            <div class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="index.html#programme">Programme</a></li>
                <li><a href="index.html#hotes">Hôtes</a></li>
                <li><a href="index.html#hebergement">Hébergement</a></li>
                <li><a href="actualites.html" class="active">Actualités</a></li>
                <li><a href="index.html#reservation">Réservation</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <div class="actualites-header">
        <h1>Toutes nos actualités</h1>
        <p>Découvrez toutes les nouvelles du Centre de Remise en Joie et restez informé de nos dernières activités et événements.</p>
    </div>

    <div class="actualites-main">
        <a href="index.html" class="retour-accueil">← Retour à l'accueil</a>
        
        <div class="actualites-list" id="actualitesListe">
            <!-- Les actualités seront chargées dynamiquement -->
        </div>
        
        <div class="pagination" id="pagination">
            <!-- La pagination sera générée dynamiquement -->
        </div>
        
        <div class="facebook-integration">
            <h3>Suivez-nous sur Facebook</h3>
            <p>Retrouvez également nos actualités et nos moments de partage sur notre page Facebook officielle.</p>
            <a href="https://www.facebook.com/p/Centre-de-Remise-en-Joie-61566852975357/" class="facebook-link" target="_blank">Visiter notre page Facebook</a>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Le Centre de Remise en Joie. Tous droits réservés.</p>
    </footer>

    <script src="supabase-config.js"></script>
    <script>
        const FALLBACK_IMAGE = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZTllY2VmIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlPC90ZXh0Pjwvc3ZnPg==';

        let allNews = [];
        const itemsPerPage = 3;
        let currentPage = 1;

        async function loadAllNews() {
            const container = document.getElementById('actualitesListe');
            container.innerHTML = '<p style="text-align:center;padding:2rem;">Chargement des actualités...</p>';

            try {
                if (typeof supabaseRest !== 'undefined') {
                    allNews = await supabaseRest.select('news', 'select=*&status=eq.published&order=date.desc');
                }
            } catch (e) {
                console.error('Erreur Supabase:', e.message);
            }

            if (allNews.length === 0) {
                container.innerHTML = '<p style="text-align:center;padding:2rem;">Aucune actualité pour le moment.</p>';
                return;
            }

            // Si un hash #news-{id} est présent, trouver la bonne page
            const hash = window.location.hash;
            if (hash && hash.startsWith('#news-')) {
                const targetId = parseInt(hash.replace('#news-', ''));
                const targetIndex = allNews.findIndex(n => n.id === targetId);
                if (targetIndex !== -1) {
                    currentPage = Math.floor(targetIndex / itemsPerPage) + 1;
                }
            }

            displayNews(currentPage);
            createPagination();

            // Scroll vers l'article ciblé après rendu
            if (hash) {
                setTimeout(() => {
                    const target = document.querySelector(hash);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        target.style.boxShadow = '0 0 0 3px #1F5733';
                        setTimeout(() => { target.style.boxShadow = ''; }, 2000);
                    }
                }, 300);
            }
        }

        function displayNews(page) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const newsToShow = allNews.slice(startIndex, endIndex);

            const container = document.getElementById('actualitesListe');
            container.innerHTML = '';

            newsToShow.forEach(actualite => {
                const article = createFullNewsArticle(actualite);
                container.appendChild(article);
            });
        }

        function createFullNewsArticle(actualite) {
            const article = document.createElement('article');
            article.className = 'actualite-full';
            article.id = `news-${actualite.id}`;

            const date = new Date(actualite.date);
            const formattedDate = date.toLocaleDateString('fr-FR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const img = document.createElement('img');
            img.src = actualite.image || FALLBACK_IMAGE;
            img.alt = actualite.titre;
            img.onerror = function() { this.onerror = null; this.src = FALLBACK_IMAGE; };

            const content = document.createElement('div');
            content.className = 'actualite-full-content';
            content.innerHTML = `
                <div class="actualite-full-date">${formattedDate}</div>
                <h2 class="actualite-full-titre">${actualite.titre}</h2>
                <div class="actualite-full-contenu">${actualite.contenu || actualite.resume || ''}</div>
            `;

            article.appendChild(img);
            article.appendChild(content);

            return article;
        }

        function createPagination() {
            const totalPages = Math.ceil(allNews.length / itemsPerPage);
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            if (totalPages <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.textContent = '← Précédent';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayNews(currentPage);
                    createPagination();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };
            paginationContainer.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.toggle('active', i === currentPage);
                pageButton.onclick = () => {
                    currentPage = i;
                    displayNews(currentPage);
                    createPagination();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };
                paginationContainer.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Suivant →';
            nextButton.disabled = currentPage === totalPages;
            nextButton.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayNews(currentPage);
                    createPagination();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };
            paginationContainer.appendChild(nextButton);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadAllNews();
            setupMobileMenu();
        });

        // Mobile menu
        function setupMobileMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const navLinks = document.getElementById('navLinks');
            if (!menuToggle || !navLinks) return;

            menuToggle.addEventListener('click', function() {
                menuToggle.classList.toggle('active');
                navLinks.classList.toggle('active');
                document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
            });

            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function() {
                    menuToggle.classList.remove('active');
                    navLinks.classList.remove('active');
                    document.body.style.overflow = '';
                });
            });

            document.addEventListener('click', function(e) {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    menuToggle.classList.remove('active');
                    navLinks.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
    </script>
</body>
</html>