<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Le Centre de Remise en Joie</title>
    <link rel="stylesheet" href="admin-styles.css">
</head>
<body>
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <h1>Administration</h1>
            <p>Centre de Remise en Joie</p>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email :</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Mot de passe :</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn-login">Se connecter</button>
            </form>
            <div id="loginError" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <div id="adminPanel" class="admin-panel" style="display: none;">
        <header class="admin-header">
            <h1>Panneau d'Administration</h1>
            <div class="admin-user-info">
                <span id="welcomeUser"></span>
                <button onclick="logout()" class="btn-logout">D√©connexion</button>
            </div>
        </header>

        <nav class="admin-nav">
            <button class="nav-btn active" onclick="showSection('actualites')">Actualit√©s</button>
            <button class="nav-btn" onclick="showSection('reservations')">R√©servations</button>
            <button class="nav-btn" onclick="showSection('disponibilites')">Disponibilit√©s</button>
            <button class="nav-btn" onclick="showSection('programme')">Programme</button>
            <button class="nav-btn" onclick="showSection('temoignages')">T√©moignages</button>
            <button class="nav-btn" onclick="showSection('contacts')">Messages</button>
            <button class="nav-btn" onclick="showSection('parametres')">Param√®tres</button>
        </nav>

        <main class="admin-content">
            <!-- Section Actualit√©s -->
            <section id="actualites-section" class="admin-section active">
                <div class="section-header">
                    <h2>Gestion des Actualit√©s</h2>
                    <button class="btn-primary" onclick="showAddNewsForm()">Ajouter une actualit√©</button>
                </div>

                <div id="newsForm" class="form-container" style="display: none;">
                    <h3 id="formTitle">Nouvelle actualit√©</h3>
                    <form id="actualiteForm">
                        <input type="hidden" id="newsId">
                        <div class="form-group">
                            <label for="newsTitre">Titre :</label>
                            <input type="text" id="newsTitre" name="titre" required>
                        </div>
                        <div class="form-group">
                            <label for="newsDate">Date :</label>
                            <input type="date" id="newsDate" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="newsResume">R√©sum√© (pour la page d'accueil) :</label>
                            <textarea id="newsResume" name="resume" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="newsContenu">Contenu complet :</label>
                            <textarea id="newsContenu" name="contenu" rows="6" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="newsImage">URL de l'image :</label>
                            <input type="url" id="newsImage" name="image" placeholder="https://exemple.com/image.jpg">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Enregistrer</button>
                            <button type="button" class="btn-secondary" onclick="hideNewsForm()">Annuler</button>
                        </div>
                    </form>
                </div>

                <div class="news-list">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="newsTableBody">
                            <!-- Les actualit√©s seront charg√©es dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section R√©servations -->
            <section id="reservations-section" class="admin-section">
                <div class="section-header">
                    <h2>Gestion des R√©servations</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterReservations('all')">Toutes</button>
                        <button class="filter-btn" onclick="filterReservations('pending')">En attente</button>
                        <button class="filter-btn" onclick="filterReservations('confirmed')">Confirm√©es</button>
                        <button class="filter-btn" onclick="filterReservations('cancelled')">Annul√©es</button>
                    </div>
                </div>

                <div class="reservations-list">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date demande</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Dates</th>
                                <th>Pers.</th>
                                <th>Type</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTableBody">
                            <!-- Les r√©servations seront charg√©es dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section Disponibilit√©s -->
            <section id="disponibilites-section" class="admin-section">
                <div class="section-header">
                    <h2>Gestion des Disponibilit√©s</h2>
                    <div class="availability-controls">
                        <button class="btn-primary" onclick="showAvailabilityForm()">Modifier les disponibilit√©s</button>
                        <button class="btn-secondary" onclick="exportAvailability()">Exporter</button>
                    </div>
                </div>

                <div class="availability-stats">
                    <div class="stat-card">
                        <h4>Taux d'occupation moyen</h4>
                        <div class="stat-value" id="statOccupation">‚Äî</div>
                    </div>
                    <div class="stat-card">
                        <h4>R√©servations ce mois</h4>
                        <div class="stat-value" id="statReservationsMois">‚Äî</div>
                    </div>
                    <div class="stat-card">
                        <h4>H√©bergement le plus demand√©</h4>
                        <div class="stat-value" id="statTopHebergement">‚Äî</div>
                    </div>
                </div>

                <div class="availability-calendar-container">
                    <div class="calendar-controls">
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" onclick="changeAdminMonth(-1)">&lt;</button>
                            <h3 id="adminCalendarMonth"></h3>
                            <button class="calendar-nav-btn" onclick="changeAdminMonth(1)">&gt;</button>
                        </div>
                        <div class="calendar-legend">
                            <div class="legend-item">
                                <div class="legend-color admin-available"></div>
                                <span>Disponible</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color admin-occupied"></div>
                                <span>Occup√©</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color admin-partial"></div>
                                <span>Partiellement occup√©</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-calendar-grid" id="adminCalendarGrid"></div>
                </div>

                <div class="accommodation-status">
                    <h3>√âtat des h√©bergements</h3>
                    <div class="accommodation-grid" id="accommodationStatusGrid">
                        <!-- Charg√© dynamiquement -->
                    </div>
                </div>
            </section>

            <!-- Section Programme -->
            <section id="programme-section" class="admin-section">
                <div class="section-header">
                    <h2>Gestion du Programme</h2>
                </div>

                <!-- Sous-onglets Activit√©s / √âv√©nements -->
                <div style="display:flex;gap:10px;margin-bottom:20px;">
                    <button class="btn-primary" id="progTabActivites" onclick="showProgrammeSubTab('activites')" style="opacity:1;">Activit√©s</button>
                    <button class="btn-secondary" id="progTabEvenements" onclick="showProgrammeSubTab('evenements')" style="opacity:0.6;">√âv√©nements</button>
                    <button class="btn-secondary" id="progTabPratiques" onclick="showProgrammeSubTab('pratiques')" style="opacity:0.6;">Pratiques</button>
                </div>

                <!-- Sous-section Activit√©s -->
                <div id="progActivitesPanel">
                    <div style="display:flex;justify-content:flex-end;margin-bottom:15px;">
                        <button class="btn-primary" onclick="showActiviteForm()">Ajouter une activit√©</button>
                    </div>

                    <div id="activiteFormPanel" style="display:none;" class="news-form">
                        <h3 id="activiteFormTitle">Nouvelle activit√©</h3>
                        <form id="activiteForm">
                            <input type="hidden" id="activiteId">
                            <div class="form-group">
                                <label for="activiteIcone">Ic√¥ne (emoji) :</label>
                                <input type="text" id="activiteIcone" placeholder="Ex : üßò" style="max-width:80px;">
                            </div>
                            <div class="form-group">
                                <label for="activiteTitre">Titre :</label>
                                <input type="text" id="activiteTitre" required>
                            </div>
                            <div class="form-group">
                                <label for="activiteDescription">Description d√©taill√©e :</label>
                                <textarea id="activiteDescription" rows="5"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="activiteImage">URL de l'image :</label>
                                <input type="url" id="activiteImage" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label for="activiteOrdre">Ordre d'affichage :</label>
                                <input type="number" id="activiteOrdre" value="0" min="0" style="max-width:80px;">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Enregistrer</button>
                                <button type="button" class="btn-secondary" onclick="hideActiviteForm()">Annuler</button>
                            </div>
                        </form>
                    </div>

                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Ordre</th>
                                <th>Ic√¥ne</th>
                                <th>Titre</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="activitesTableBody">
                            <!-- Charg√© dynamiquement -->
                        </tbody>
                    </table>
                </div>

                <!-- Sous-section √âv√©nements -->
                <div id="progEvenementsPanel" style="display:none;">
                    <div style="display:flex;justify-content:flex-end;margin-bottom:15px;">
                        <button class="btn-primary" onclick="showEvenementForm()">Ajouter un √©v√©nement</button>
                    </div>

                    <div id="evenementFormPanel" style="display:none;" class="news-form">
                        <h3 id="evenementFormTitle">Nouvel √©v√©nement</h3>
                        <form id="evenementForm">
                            <input type="hidden" id="evenementId">
                            <div class="form-group">
                                <label for="evenementTitre">Titre :</label>
                                <input type="text" id="evenementTitre" required>
                            </div>
                            <div class="form-group" style="display:flex;gap:15px;">
                                <div style="flex:1;">
                                    <label for="evenementDateDebut">Date d√©but :</label>
                                    <input type="date" id="evenementDateDebut" required>
                                </div>
                                <div style="flex:1;">
                                    <label for="evenementDateFin">Date fin :</label>
                                    <input type="date" id="evenementDateFin">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="evenementHoraires">Horaires :</label>
                                <input type="text" id="evenementHoraires" placeholder="Ex : Samedi de 10h √† 13h">
                            </div>
                            <div class="form-group">
                                <label for="evenementIntervenant">Intervenant :</label>
                                <input type="text" id="evenementIntervenant" placeholder="Ex : Aur√©lia ‚Äì M√©jisound">
                            </div>
                            <div class="form-group">
                                <label for="evenementResume">R√©sum√© (affich√© dans la liste) :</label>
                                <input type="text" id="evenementResume" placeholder="Courte description">
                            </div>
                            <div class="form-group">
                                <label for="evenementDescription">Description compl√®te (affich√©e au clic) :</label>
                                <textarea id="evenementDescription" rows="5"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="evenementImageFile">Image :</label>
                                <input type="file" id="evenementImageFile" accept="image/*" onchange="previewEvenementImage(this)">
                                <div id="evenementImagePreview" style="margin-top:10px;display:none;">
                                    <img id="evenementImagePreviewImg" src="" alt="Aper√ßu" style="max-width:300px;max-height:200px;border-radius:8px;object-fit:cover;">
                                    <button type="button" onclick="clearEvenementImage()" style="display:block;margin-top:6px;background:none;border:none;color:#c00;cursor:pointer;font-size:0.9em;">Supprimer l'image</button>
                                </div>
                                <input type="hidden" id="evenementImage">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Enregistrer</button>
                                <button type="button" class="btn-secondary" onclick="hideEvenementForm()">Annuler</button>
                            </div>
                        </form>
                    </div>

                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Titre</th>
                                <th>Intervenant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="evenementsTableBody">
                            <!-- Charg√© dynamiquement -->
                        </tbody>
                    </table>
                </div>

                <!-- Sous-section Pratiques -->
                <div id="progPratiquesPanel" style="display:none;">
                    <div style="display:flex;justify-content:flex-end;margin-bottom:15px;">
                        <button class="btn-primary" onclick="showPratiqueForm()">Ajouter un lieu de pratique</button>
                    </div>

                    <div id="pratiqueFormPanel" style="display:none;" class="news-form">
                        <h3 id="pratiqueFormTitle">Nouveau lieu de pratique</h3>
                        <form id="pratiqueForm">
                            <input type="hidden" id="pratiqueId">
                            <div class="form-group">
                                <label for="pratiqueTitre">Titre :</label>
                                <input type="text" id="pratiqueTitre" required>
                            </div>
                            <div class="form-group">
                                <label for="pratiqueResume">R√©sum√© (affich√© dans la carte) :</label>
                                <textarea id="pratiqueResume" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="pratiqueDescription">Description compl√®te (affich√©e au clic) :</label>
                                <textarea id="pratiqueDescription" rows="5"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="pratiqueImageFile">Image :</label>
                                <input type="file" id="pratiqueImageFile" accept="image/*" onchange="previewPratiqueImage(this)">
                                <div id="pratiqueImagePreview" style="margin-top:10px;display:none;">
                                    <img id="pratiqueImagePreviewImg" src="" alt="Aper√ßu" style="max-width:300px;max-height:200px;border-radius:8px;object-fit:cover;">
                                    <button type="button" onclick="clearPratiqueImage()" style="display:block;margin-top:6px;background:none;border:none;color:#c00;cursor:pointer;font-size:0.9em;">Supprimer l'image</button>
                                </div>
                                <input type="hidden" id="pratiqueImage">
                            </div>
                            <div class="form-group">
                                <label for="pratiqueVideo">URL vid√©o (optionnel, ex : videos/yourte.webm) :</label>
                                <input type="text" id="pratiqueVideo" placeholder="videos/yourte.webm">
                            </div>
                            <div class="form-group">
                                <label for="pratiqueOrdre">Ordre d'affichage :</label>
                                <input type="number" id="pratiqueOrdre" value="0" min="0" style="max-width:80px;">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Enregistrer</button>
                                <button type="button" class="btn-secondary" onclick="hidePratiqueForm()">Annuler</button>
                            </div>
                        </form>
                    </div>

                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Ordre</th>
                                <th>Titre</th>
                                <th>M√©dia</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pratiquesTableBody">
                            <!-- Charg√© dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section T√©moignages -->
            <section id="temoignages-section" class="admin-section">
                <div class="section-header">
                    <h2>Gestion des T√©moignages</h2>
                    <button class="btn-primary" onclick="showAddTestimonialForm()">Ajouter un t√©moignage</button>
                </div>

                <div id="testimonialForm" style="display:none;" class="news-form">
                    <h3 id="testimonialFormTitle">Nouveau t√©moignage</h3>
                    <form id="temoignageForm">
                        <input type="hidden" id="temoignageId">
                        <div class="form-group">
                            <label for="temoignageAuteur">Pr√©nom / Nom :</label>
                            <input type="text" id="temoignageAuteur" required>
                        </div>
                        <div class="form-group">
                            <label for="temoignageRole">R√¥le / Contexte :</label>
                            <input type="text" id="temoignageRole" placeholder="Ex : Participante aux ateliers de m√©ditation">
                        </div>
                        <div class="form-group">
                            <label for="temoignageTexte">T√©moignage :</label>
                            <textarea id="temoignageTexte" rows="6" required></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Enregistrer</button>
                            <button type="button" class="btn-secondary" onclick="hideTestimonialForm()">Annuler</button>
                        </div>
                    </form>
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Auteur</th>
                            <th>T√©moignage</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="temoignagesTableBody">
                        <!-- Charg√© dynamiquement -->
                    </tbody>
                </table>
            </section>

            <!-- Section Messages -->
            <section id="contacts-section" class="admin-section">
                <div class="section-header">
                    <h2>Messages de Contact</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterContacts('all')">Tous</button>
                        <button class="filter-btn" onclick="filterContacts('unread')">Non lus</button>
                        <button class="filter-btn" onclick="filterContacts('read')">Lus</button>
                    </div>
                </div>

                <div class="contacts-list">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Message</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contactsTableBody">
                            <!-- Les messages seront charg√©s dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Modale r√©ponse contact -->
            <div id="replyModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;display:none;align-items:center;justify-content:center;">
                <div style="background:#fff;border-radius:12px;padding:30px;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 10px 30px rgba(0,0,0,0.3);">
                    <h3 style="margin-top:0;color:#1F5733;">R√©pondre au message</h3>
                    <div id="replyOriginalMessage" style="background:#f5f5f5;padding:12px;border-radius:8px;margin-bottom:15px;font-size:0.9em;"></div>
                    <div class="form-group">
                        <label for="replyText"><strong>Votre r√©ponse :</strong></label>
                        <textarea id="replyText" rows="6" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-family:inherit;font-size:1em;resize:vertical;"></textarea>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:15px;">
                        <button class="btn-secondary" onclick="closeReplyModal()">Annuler</button>
                        <button class="btn-primary" id="sendReplyBtn" onclick="sendReply()">Envoyer la r√©ponse</button>
                    </div>
                </div>
            </div>

            <!-- Section Param√®tres -->
            <section id="parametres-section" class="admin-section">
                <div class="section-header">
                    <h2>Param√®tres du Site</h2>
                </div>

                <div class="settings-form">
                    <div class="form-group">
                        <label for="siteName">Nom du site :</label>
                        <input type="text" id="siteName" value="Le Centre de Remise en Joie">
                    </div>
                    <div class="form-group">
                        <label for="siteEmail">Email de contact :</label>
                        <input type="email" id="siteEmail" value="contact@chaletananda.fr">
                    </div>
                    <div class="form-group">
                        <label for="sitePhone">T√©l√©phone :</label>
                        <input type="tel" id="sitePhone" value="06 21 39 72 24">
                    </div>
                    <div class="form-group">
                        <label for="siteAddress">Adresse :</label>
                        <textarea id="siteAddress" rows="3">Le balcon d'Aug√®re
63210 Vernines France</textarea>
                    </div>
                    <div class="form-group">
                        <label for="facebookUrl">URL Facebook :</label>
                        <input type="url" id="facebookUrl" value="https://facebook.com/chaletananda">
                    </div>
                    <div class="form-group">
                        <label for="facebookIntegration">Int√©gration Facebook :</label>
                        <select id="facebookIntegration">
                            <option value="disabled" selected>D√©sactiv√©e</option>
                            <option value="enabled">Activ√©e</option>
                        </select>
                        <small>
                            <strong>Pas de page Facebook Business ?</strong><br>
                            ‚Ä¢ Laissez "D√©sactiv√©e" pour utiliser seulement vos actualit√©s locales<br>
                            ‚Ä¢ Ou <a href="https://facebook.com/pages/create" target="_blank">cr√©ez une page Facebook Business gratuitement</a>
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="facebookPageId">ID de votre page Facebook :</label>
                        <input type="text" id="facebookPageId" placeholder="123456789012345">
                        <small>L'ID num√©rique de votre page Facebook (visible dans l'URL ou les param√®tres)</small>
                    </div>
                    <div class="form-group">
                        <label for="facebookToken">Token d'acc√®s Facebook :</label>
                        <input type="password" id="facebookToken" placeholder="Votre token d'acc√®s Facebook">
                        <small>Token d'acc√®s √† la page pour l'API Graph (g√©n√©r√© via Facebook Developers)</small>
                    </div>
                    <div class="form-group facebook-test">
                        <button type="button" class="btn-secondary" onclick="testFacebookConnection()">
                            üîç Tester la connexion Facebook
                        </button>
                        <button type="button" class="btn-secondary" onclick="refreshFacebookPosts()">
                            üîÑ Actualiser les posts Facebook
                        </button>
                        <div class="facebook-status" id="facebookPageName"></div>
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">Enregistrer les param√®tres</button>
                </div>

                <div class="backup-section">
                    <h3>Sauvegarde des donn√©es</h3>
                    <div class="backup-actions">
                        <button class="btn-secondary" onclick="exportData()">Exporter les donn√©es</button>
                        <button class="btn-secondary" onclick="importData()">Importer des donn√©es</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>emailjs.init('Vtm7CrgdmlhwGYHb9');</script>
    <script src="supabase-config.js"></script>
    <script src="admin-script.js"></script>
</body>
</html>